<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.20" /><meta name="theme" content="VuePress Theme Plume 1.0.0-rc.138" /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><link rel="icon" href="/image/favicon.ico"><title>2.红黑树 | 一个柚子</title><meta name="description" content="一个柚子的博客"><link rel="preload" href="/assets/style-Box7VrGz.css" as="style"><link rel="stylesheet" href="/assets/style-Box7VrGz.css"><link rel="modulepreload" href="/assets/app-k3221GFj.js"><link rel="modulepreload" href="/assets/index.html-C5J-aOjW.js"><link rel="prefetch" href="/assets/index.html-BUzGYcmO.js" as="script"><link rel="prefetch" href="/assets/index.html-CB1DMPgc.js" as="script"><link rel="prefetch" href="/assets/index.html-4opN9Psn.js" as="script"><link rel="prefetch" href="/assets/index.html-BvGs911_.js" as="script"><link rel="prefetch" href="/assets/index.html-W-ylOTKi.js" as="script"><link rel="prefetch" href="/assets/index.html-5dbMCqlh.js" as="script"><link rel="prefetch" href="/assets/index.html-Nc9oIcgi.js" as="script"><link rel="prefetch" href="/assets/index.html-kki5V07W.js" as="script"><link rel="prefetch" href="/assets/index.html-C9PUz_ph.js" as="script"><link rel="prefetch" href="/assets/index.html-CZONieA6.js" as="script"><link rel="prefetch" href="/assets/index.html-BIzsRxn5.js" as="script"><link rel="prefetch" href="/assets/index.html-BNw7Bed9.js" as="script"><link rel="prefetch" href="/assets/index.html-BigejmyL.js" as="script"><link rel="prefetch" href="/assets/index.html-B8ipDPzp.js" as="script"><link rel="prefetch" href="/assets/404.html-CEdnT4lN.js" as="script"><link rel="prefetch" href="/assets/index.html-PM0iYFdj.js" as="script"><link rel="prefetch" href="/assets/index.html-D_RUo1VL.js" as="script"><link rel="prefetch" href="/assets/index.html-BaM3IYd-.js" as="script"><link rel="prefetch" href="/assets/index.html-BMlHJYQT.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-DXWKOczD.js" as="script"><link rel="prefetch" href="/assets/searchBox-default-DiWUnjYp.js" as="script"><link rel="prefetch" href="/assets/SearchBox-CEGNscyC.js" as="script"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-1fc9cae9><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-82b07878></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-82b07878> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-1fc9cae9 data-v-db4466d2><div class="vp-navbar" vp-navbar data-v-db4466d2 data-v-220bb5de><div class="wrapper" data-v-220bb5de><div class="container" data-v-220bb5de><div class="title" data-v-220bb5de><div class="vp-navbar-title" data-v-220bb5de data-v-c56d9d5d><a class="vp-link no-icon link title" href="/" data-v-c56d9d5d data-v-4f934dc8><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" style="" src="/image/favicon.ico" alt data-v-ba4a78ee><!--]--><!--[--><img class="vp-image light logo" style="" src="/image/favicon.ico" alt data-v-ba4a78ee><!--]--><!--]--><!--]--><span data-v-c56d9d5d>一个柚子</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-220bb5de><div class="content-body" data-v-220bb5de><!--[--><!--]--><div class="vp-navbar-search search" data-v-220bb5de><div class="search-wrapper" data-v-5d6375d7><!----><div id="local-search" data-v-5d6375d7><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-5d6375d7><span class="mini-search-button-container"><span class="mini-search-search-icon vpi-mini-search" aria-label="search icon"></span><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-220bb5de data-v-fae93b98><span id="main-nav-aria-label" class="visually-hidden" data-v-fae93b98>Main Navigation</span><!--[--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/" tabindex="0" data-v-fae93b98 data-v-a5b3635e data-v-4f934dc8><!--[--><!----><span data-v-a5b3635e>首页</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/" tabindex="0" data-v-fae93b98 data-v-a5b3635e data-v-4f934dc8><!--[--><!----><span data-v-a5b3635e>博客</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/tags/" tabindex="0" data-v-fae93b98 data-v-a5b3635e data-v-4f934dc8><!--[--><!----><span data-v-a5b3635e>标签</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/archives/" tabindex="0" data-v-fae93b98 data-v-a5b3635e data-v-4f934dc8><!--[--><!----><span data-v-a5b3635e>归档</span><!--]--><!----></a><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-fae93b98 data-v-1489b867><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-1489b867><span class="text" data-v-1489b867><!----><!----><span data-v-1489b867>笔记</span><span class="vpi-chevron-down text-icon" data-v-1489b867></span></span></button><div class="menu" data-v-1489b867><div class="vp-menu" data-v-1489b867 data-v-db169e76><div class="items" data-v-db169e76><!--[--><!--[--><div class="vp-menu-link" data-v-db169e76 data-v-77026440><a class="vp-link no-icon link" href="/demo/" data-v-77026440 data-v-4f934dc8><!--[--><!----> 示例<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="vp-navbar-appearance appearance" data-v-220bb5de data-v-b1addd14><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-b1addd14 data-v-993d65ed data-v-049af359><span class="check" data-v-049af359><span class="icon" data-v-049af359><!--[--><span class="vpi-sun sun" data-v-993d65ed></span><span class="vpi-moon moon" data-v-993d65ed></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-220bb5de data-v-d89d0a33 data-v-942f7225><!--[--><a class="vp-social-link no-icon" href="https://github.com/ShaddockWong" aria-label="github" target="_blank" rel="noopener" data-v-942f7225 data-v-c483cc0d><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-220bb5de data-v-a109fff2 data-v-1489b867><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-1489b867><span class="vpi-more-horizontal icon" data-v-1489b867></span></button><div class="menu" data-v-1489b867><div class="vp-menu" data-v-1489b867 data-v-db169e76><!----><!--[--><!--[--><!----><div class="group" data-v-a109fff2><div class="item appearance" data-v-a109fff2><p class="label" data-v-a109fff2>外观</p><div class="appearance-action" data-v-a109fff2><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-a109fff2 data-v-993d65ed data-v-049af359><span class="check" data-v-049af359><span class="icon" data-v-049af359><!--[--><span class="vpi-sun sun" data-v-993d65ed></span><span class="vpi-moon moon" data-v-993d65ed></span><!--]--></span></span></button></div></div></div><div class="group" data-v-a109fff2><div class="item social-links" data-v-a109fff2><div class="vp-social-links social-links-list" data-v-a109fff2 data-v-942f7225><!--[--><a class="vp-social-link no-icon" href="https://github.com/ShaddockWong" aria-label="github" target="_blank" rel="noopener" data-v-942f7225 data-v-c483cc0d><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-220bb5de data-v-6d2cb7cf><span class="container" data-v-6d2cb7cf><span class="top" data-v-6d2cb7cf></span><span class="middle" data-v-6d2cb7cf></span><span class="bottom" data-v-6d2cb7cf></span></span></button></div></div></div></div><div class="divider" data-v-220bb5de><div class="divider-line" data-v-220bb5de></div></div></div><!----></header><div class="vp-local-nav fixed reached-top is-blog" data-v-1fc9cae9 data-v-efadfaed><button class="hidden menu" disabled aria-expanded="false" aria-controls="SidebarNav" data-v-efadfaed><span class="vpi-align-left menu-icon" data-v-efadfaed></span><span class="menu-text" data-v-efadfaed>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-efadfaed data-v-224bf1bc><button data-v-224bf1bc>返回顶部</button><!----></div></div><!----><!--[--><div id="VPContent" vp-content class="vp-content" data-v-1fc9cae9 data-v-69308628><div class="vp-doc-container is-blog" data-v-69308628 data-v-560bc32b><!--[--><!--]--><div class="container" data-v-560bc32b><!----><div class="content" data-v-560bc32b><div class="content-container" data-v-560bc32b><!--[--><!--]--><main class="main" data-v-560bc32b><nav class="vp-breadcrumb" data-v-560bc32b data-v-acdb1f75><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-acdb1f75><!--[--><li property="itemListElement" typeof="ListItem" data-v-acdb1f75><a class="vp-link no-icon link breadcrumb" href="/" property="item" typeof="WebPage" data-v-acdb1f75 data-v-4f934dc8><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-acdb1f75></span><meta property="name" content="首页" data-v-acdb1f75><meta property="position" content="1" data-v-acdb1f75></li><li property="itemListElement" typeof="ListItem" data-v-acdb1f75><a class="vp-link no-icon link breadcrumb" href="/blog/" property="item" typeof="WebPage" data-v-acdb1f75 data-v-4f934dc8><!--[-->博客<!--]--><!----></a><span class="vpi-chevron-right" data-v-acdb1f75></span><meta property="name" content="博客" data-v-acdb1f75><meta property="position" content="2" data-v-acdb1f75></li><li property="itemListElement" typeof="ListItem" data-v-acdb1f75><a class="vp-link no-icon link breadcrumb" href="/blog/categories/?id=335529" property="item" typeof="WebPage" data-v-acdb1f75 data-v-4f934dc8><!--[-->数据结构与算法<!--]--><!----></a><span class="vpi-chevron-right" data-v-acdb1f75></span><meta property="name" content="数据结构与算法" data-v-acdb1f75><meta property="position" content="3" data-v-acdb1f75></li><li property="itemListElement" typeof="ListItem" data-v-acdb1f75><a class="vp-link no-icon link breadcrumb current" href="/article/mysf7tdo/" property="item" typeof="WebPage" data-v-acdb1f75 data-v-4f934dc8><!--[-->2.红黑树<!--]--><!----></a><!----><meta property="name" content="2.红黑树" data-v-acdb1f75><meta property="position" content="4" data-v-acdb1f75></li><!--]--></ol></nav><!--[--><h1 class="vp-doc-title page-title" data-v-b2337b26>2.红黑树 <!----></h1><div class="vp-doc-meta" data-v-b2337b26><p class="reading-time" data-v-b2337b26><span class="vpi-books icon" data-v-b2337b26></span><span data-v-b2337b26>约 6986 字</span><span data-v-b2337b26>大约 23 分钟</span></p><p data-v-b2337b26><span class="vpi-tag icon" data-v-b2337b26></span><!--[--><a class="vp-link no-icon link tag vp-tag-xpd4" href="/blog/tags/?tag=数据结构" data-v-b2337b26 data-v-4f934dc8><!--[-->数据结构<!--]--><!----></a><a class="vp-link no-icon link tag vp-tag-0imp" href="/blog/tags/?tag=算法" data-v-b2337b26 data-v-4f934dc8><!--[-->算法<!--]--><!----></a><!--]--></p><p class="create-time" data-v-b2337b26><span class="vpi-clock icon" data-v-b2337b26></span><span data-v-b2337b26>2025-06-04</span></p></div><!--]--><div class="_article_mysf7tdo_ external-link-icon-enabled vp-doc plume-content" vp-content data-v-560bc32b><div data-v-560bc32b><h2 id="红黑树为何必须掌握" tabindex="-1"><a class="header-anchor" href="#红黑树为何必须掌握"><span>红黑树为何必须掌握</span></a></h2><p>先来看看，红黑树的广泛应用：</p><ul><li>JDK1.8 开始，HashMap 也引入了红黑树：当冲突的链表长度超过 8 时，自动转为红黑树。</li><li>Java中，TreeMap、TreeSet都使用红黑树作为底层数据结构。</li><li>Linux底层的 CFS 进程调度算法中，vruntime 使用红黑树进行存储。</li><li>多路复用技术的 Epoll，其核心结构是红黑树 + 双向链表。</li></ul><h3 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h3><blockquote><p>本文，从 BST二叉查找树，到 AVL 平衡二叉树，再到 RBT 红黑树，</p><p>为大家做好<strong>清晰的场景分析</strong>，帮助大家记忆。</p></blockquote><h2 id="bst-二叉搜索树" tabindex="-1"><a class="header-anchor" href="#bst-二叉搜索树"><span>BST 二叉搜索树</span></a></h2><h3 id="什么是二叉搜索树呢" tabindex="-1"><a class="header-anchor" href="#什么是二叉搜索树呢"><span>什么是二叉搜索树呢？</span></a></h3><p>二叉搜索树（BST）具备以下特性：</p><ol><li>左子树上所有结点的值均小于或等于它的根结点的值。</li><li>右子树上所有结点的值均大于或等于它的根结点的值。</li><li>左、右子树也分别为二叉排序树。</li></ol><h3 id="二叉搜索树-bst-的完美情况" tabindex="-1"><a class="header-anchor" href="#二叉搜索树-bst-的完美情况"><span>二叉搜索树 BST 的完美情况</span></a></h3><p>一般人们理解的二叉树（<strong>又叫二叉搜索树 BST</strong>）会出现一个问题，完美的情况下，它是这样的：</p><p><img src="/assets/image-20250604145849040-mMKqN95D.png" alt="BST"></p><h3 id="二叉搜索树的查找流程" tabindex="-1"><a class="header-anchor" href="#二叉搜索树的查找流程"><span>二叉搜索树的查找流程</span></a></h3><p>如何查找值为 7 的节点？</p><ol><li>查看根节点 8，因为 7 &lt; 8，所以再查看它的左子节点 6；</li><li>查看左子节点 6，因为 7 &gt; 6，所以再查看它的右子节点 7；</li><li>查看右子节点 7，因为 7 = 7，所以就找到啦。</li></ol><h3 id="二叉搜索树的极端情况" tabindex="-1"><a class="header-anchor" href="#二叉搜索树的极端情况"><span>二叉搜索树的极端情况</span></a></h3><p>二叉查找树是有缺点的，在不断插入的时候，**有可能出现这样一种情况：**很容易“退化”成链表，</p><p>如果 BST 树的节点正好从大到小的插入，此时树的结构也类似于链表结构，这时候的查询或写入耗时与链表相同。</p><p><strong>退化成为了链表的特殊BST</strong></p><p>一课特殊 BST，退化成为了链表，如下图：</p><p><img src="/assets/fbbb12eb4a708f7c02cfaf1cda065d24-CMOa2ge-.png" alt="BST退化为链表"></p><p>它和链表一样，搜索的时候，最坏情况的时间复杂度 O(n) 。</p><p><strong>那么我们怎么避免这种情况呢？</strong></p><p>为了避免这种特殊的情况发生，引入了平衡二叉树（AVL）和红黑树（red-black tree）。</p><p>AVL、RBT 都是通过本身的建树原则来控制树的层数和节点位置，</p><p>因为 RBT 是由 AVL 演变而来，所以我们从了解 AVL 开始。</p><h2 id="avl-平衡二叉树" tabindex="-1"><a class="header-anchor" href="#avl-平衡二叉树"><span>AVL 平衡二叉树</span></a></h2><p>平衡二叉树也叫 AVL（得名于它的发明者 G. M. Adelson-Velsky 和 Evgenii Landis，他们在1962年的论文《An algorithm for the organization of information》中公开了这一数据结构），也属于二叉搜索树的一种，与其不同的是AVL通过机制保证其自身的平衡。</p><blockquote><p>AVL 树是最先发明的自平衡二叉查找树。</p><p>在 AVL 树中任何节点的两个子树的高度最大差别为1，所以它也被称为高度平衡树。</p><p>增加和删除可能需要通过一次或多次树旋转来重新平衡这个树。</p></blockquote><h3 id="avl-树的特性" tabindex="-1"><a class="header-anchor" href="#avl-树的特性"><span>AVL 树的特性</span></a></h3><p>AVL树本质上还是一棵二叉搜索树，它有以下特性：</p><ul><li>特性1： 对于任何一颗子树的 root 根结点而言，它的左子树任何节点的key一定比 root 小，而右子树任何节点的 key 一定比 root 大；</li><li>特性2：对于 AVL 树而言，其中任何子树仍然是 AVL 树；</li><li>特性3：每个节点的左右子节点的高度之差的绝对值最多为1；</li></ul><blockquote><p>特性1表明，AVL 继承于 BST ,所以:</p><ol><li>AVL 本身首先是一棵 BST 二叉搜索树。</li><li>AVL 带有平衡条件：每个结点的左右子树的高度之差的绝对值（平衡因子）最多为1。</li></ol></blockquote><p>在插入、删除树节点的时候，如果破坏了以上的原则，<strong>AVL 树会自动进行调整</strong>使得以上三条原则仍然成立。</p><p>也就是说，AVL 树，本质上是<strong>带了平衡功能的二叉查找树</strong>（二叉排序树，二叉搜索树）。</p><h3 id="avl-树的平衡功能" tabindex="-1"><a class="header-anchor" href="#avl-树的平衡功能"><span>AVL 树的平衡功能</span></a></h3><p>举个例子，下左图为 AVL 树最长的2节点与最短的8节点高度差为1；</p><p>当插入一个新的节点后，根据上面第一条原则，它会出现在2节点的左子树，但这样一来就违反了原则3。</p><p><img src="/assets/a075215c8d79d1930c4233e44bb7a8ae-DeTzxA2K.png" alt="AVL树失衡"></p><p>此时 AVL 树会通过节点的旋转进行进行平衡，</p><p>AVL 调整的过程称之为左旋和右旋，</p><h3 id="avl-平衡的调整过程" tabindex="-1"><a class="header-anchor" href="#avl-平衡的调整过程"><span>AVL 平衡的调整过程</span></a></h3><p><strong>旋转之前，首先确定旋转支点（pivot）：</strong> 这个旋转支点就是失去平衡这部分树，在自平衡之后的根节点，</p><p>平衡的调整过程，需要根据pivot它来进行旋转。</p><p>我们在学习 AVL 树的旋转时，不要将失衡问题扩大到整个树来看，这样会扰乱你的思路，</p><p>我们只关注<strong>失衡子树的根结点</strong> 及它的子节点和孙子节点即可。</p><p>事实上，AVL 树的旋转，我们权且叫“AVL 旋转”是有规律可循的，因为只要聚焦到**失衡子树，**然后进行左旋、右旋即可。</p><blockquote><p>很多人在左旋和右旋有时候弄不明白，</p><p>其实左旋就是逆时针转，右旋是顺时针转。</p></blockquote><h2 id="avl-子树失衡的四大场景" tabindex="-1"><a class="header-anchor" href="#avl-子树失衡的四大场景"><span>AVL 子树失衡的四大场景</span></a></h2><p>导致 AVL 失衡的场景就是有限的4个：</p><ul><li>左左结构失衡（LL 型失衡）</li><li>右右结构失衡（RR 型失衡）</li><li>左右结构失衡（LR 型失衡）</li><li>右左结构失衡（RL 型失衡）</li></ul><p>删除元素，也会导致 AVL 失衡，需要再平衡，但是原理和插入元素是类似的。</p><p>这里聚焦 介绍插入元素的平衡过程，删除元素，不做介绍。</p><h3 id="场景1-ll-型失衡-左左结构失衡-右旋" tabindex="-1"><a class="header-anchor" href="#场景1-ll-型失衡-左左结构失衡-右旋"><span>场景1:LL 型失衡-左左结构失衡（右旋）：</span></a></h3><blockquote><p>场景：插入的元素在子树 root 的左侧不平衡元素的左侧。</p><p>此时，以 root 的左子节点为支点，也就是，左侧的不平衡元素为 pivot (支点),进行右旋。</p></blockquote><p><img src="/assets/82f3502b5be24051bd7688b1e0f36135-Ba0DhpY_.png" alt="AVL树的右旋"></p><p>来一个右旋的动画：</p><p><img src="/assets/96a7aa160f13424abb4acd1ada47edbf-BOoVLUQ9.webp" alt="AVL右旋"></p><blockquote><p>右旋过程中，如果 pivot 有右子树，则作为原 root 的左子树，保障 AVL 的特性1</p></blockquote><h4 id="记忆要点" tabindex="-1"><a class="header-anchor" href="#记忆要点"><span>记忆要点</span></a></h4><p>LL 型失衡怎么平衡呢？</p><blockquote><p>旋转的反向，与失衡的方向相反，</p><p>LL 型失衡，与左边相反的方向，是右边，所以是右旋</p></blockquote><h3 id="场景2-rr-型失衡-右右结构失衡-左旋" tabindex="-1"><a class="header-anchor" href="#场景2-rr-型失衡-右右结构失衡-左旋"><span>场景2 RR 型失衡：右右结构失衡（左旋）</span></a></h3><blockquote><p>场景：插入的元素在子树 root 右侧的不平衡子树的右侧</p><p>此时，以 root 的右儿为支点，也就是，右侧的不平衡元素 为 pivot(支点)， 进行左旋</p></blockquote><p><img src="/assets/dea622e0576539552458e3afcffb1f59-4f_PHT1E.png" alt="img"></p><p>来一个左旋的动画：</p><p><img src="/assets/ba1adc2895cf4b1aaef2e7088d9f6a69-BU-Zmjk2.webp" alt="在这里插入图片描述"></p><blockquote><p>左旋过程中，如果pivot有左子树，则作为 原root的 右子树，</p><p>保障AVL的特性1，</p></blockquote><h4 id="记忆要点-1" tabindex="-1"><a class="header-anchor" href="#记忆要点-1"><span>记忆要点</span></a></h4><p>RR型失衡怎么 平衡呢？</p><blockquote><p>旋转的反向，<strong>与失衡的方向相反</strong>，</p><p>RR 型失衡，与右边 相反的方向， 是左边，所以是左旋</p></blockquote><h3 id="场景3-lr-型失衡-左右结构失衡-左旋-右旋" tabindex="-1"><a class="header-anchor" href="#场景3-lr-型失衡-左右结构失衡-左旋-右旋"><span>场景3 LR 型失衡：左右结构失衡（左旋+右旋）：</span></a></h3><blockquote><p>场景： 插入的元素在左侧的不平衡元素的右侧</p></blockquote><p><img src="/assets/a50f45a2c27e4f330603481789d5234c-DJuPU-ws.png" alt="img"></p><h4 id="记忆要点-2" tabindex="-1"><a class="header-anchor" href="#记忆要点-2"><span>记忆要点</span></a></h4><p>LR 型失衡怎么 平衡呢？</p><blockquote><p>旋转的反向，<strong>与失衡的方向相反</strong>，</p><p>LR型失衡，与只相反的方向是 RL，但是先旋转底部，再旋转顶部，RL进行次序颠倒，LR</p><p>所以， LR型失衡，旋转的方式，是先左旋， 再右旋</p></blockquote><h3 id="场景4-rl-失衡-右左结构-右旋-左旋" tabindex="-1"><a class="header-anchor" href="#场景4-rl-失衡-右左结构-右旋-左旋"><span>场景4 RL 失衡: 右左结构 （右旋+左旋）：</span></a></h3><p>场景： 插入的元素在右侧的不平衡元素的左侧</p><p><img src="/assets/24326f9fded29e6f566738f86525d468-Cf1MSTB_.png" alt="img"></p><h4 id="记忆要点-3" tabindex="-1"><a class="header-anchor" href="#记忆要点-3"><span>记忆要点</span></a></h4><p>尼恩备注记忆要点，RL型失衡怎么 平衡呢？</p><blockquote><p>旋转的反向，<strong>与失衡的方向相反</strong>，</p><p>RL型失衡，与只相反的方向是 LR，但是先旋转底部，再旋转顶部，所以，LR 进行次序颠倒，RL；</p><p>最终， RL型失衡，旋转的方式，是先右旋， 再左旋。</p></blockquote><h3 id="avl-树平衡总结" tabindex="-1"><a class="header-anchor" href="#avl-树平衡总结"><span>AVL 树平衡总结</span></a></h3><p>可见无论哪种情况的失衡，都可以通过旋转来调整。</p><p>不难看出，旋转在图上像是将 pivot (支点)节点向上提（将它提升为 root 节点），而后两边的节点会物理的分布在新 root 节点的两边，</p><p>接下来按照 AV L二叉树的要求：</p><blockquote><p>左子树小于 root，右子树大于 root 进行调整。</p></blockquote><p>从图LL结构可以看出，当右旋时原来pivot（7）的右子树（8）会转变到原root点（9）的左子树处；</p><p><img src="/assets/82f3502b5be24051bd7688b1e0f36135-Ba0DhpY_.png" alt="img"></p><p>从图右右结构可见，当左旋时，原来pivot（18）的左子树会分布到原root点（9）的右子树。</p><p><img src="/assets/dea622e0576539552458e3afcffb1f59-4f_PHT1E.png" alt="img"></p><p>对于左右结构和右左结构无非是经过多次旋转达到稳定，旋转的方式并没有区别，</p><p>AVL 树本质上还是一棵<strong>二叉搜索树</strong>，它有以下特性： 1.本身首先是一棵二叉搜索树。 2.带有平衡条件：每个结点的左右子树的高度之差的绝对值（平衡因子）最多为1。</p><p>也就是说，AVL 树，本质上是<strong>带了平衡功能的二叉查找树</strong>（二叉排序树，二叉搜索树）。</p><h3 id="avl树的删除" tabindex="-1"><a class="header-anchor" href="#avl树的删除"><span>AVL树的删除</span></a></h3><p><strong>删除的判断标准</strong></p><ol><li>要删除的节点是什么类型的节点？；</li><li>删除后是否会破坏平衡 ；</li></ol><p><strong>节点类型</strong></p><ol><li>叶子节点；</li><li>节点只有左子树或只有右子树 ；</li><li>既有左右子树都有。</li></ol><p><strong>处理的思路</strong></p><ol><li>当删除为叶子节点，则直接删除，并从父亲节点开始往上看，判断是否失衡；如果没有失衡，再判断父亲的父节点是否失衡，直到根节点。若失衡则判断失衡类型（LL、LR、RR、RL），再进行相应的调整。</li><li>删除的节点只有左子树或只有右子树，那么将节点删除，以左子树或右子树进行代替，并进行相应的平衡判断，若失衡则调整，一直到根节点 ；</li><li>删除的节点既有左子树又有右子树，找到其前驱或者后驱节点将其替换，再判断是否失衡，然后根据失衡情况调整，直到根节点。</li></ol><h2 id="常见avl面试题" tabindex="-1"><a class="header-anchor" href="#常见avl面试题"><span>常见AVL面试题</span></a></h2><h3 id="问-什么是avl左旋和右旋" tabindex="-1"><a class="header-anchor" href="#问-什么是avl左旋和右旋"><span>问：什么是AVL左旋和右旋？</span></a></h3><blockquote><p>加入节点后，左旋和右旋 ，维护AVL平衡性</p></blockquote><p>右旋转</p><p>场景： 插入的元素在不平衡元素的左侧的左侧</p><blockquote><p>x.right = y</p><p>y.left = xxx(原x.right)</p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">   对节点y进行向右旋转操作</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">，</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">返回旋转后新的根节点x</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">            y</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                             x</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">           /</span><span style="--shiki-light:#BDA437;--shiki-dark:#E6CC77;"> \ </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">                         /</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">   \</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          x</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">   T4</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">     向右旋转</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">y</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">        z</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">     y</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">         /</span><span style="--shiki-light:#BDA437;--shiki-dark:#E6CC77;"> \ </span><span style="--shiki-light:#AB5E3F;--shiki-dark:#C4704F;">      - - - - - - - -&gt;    </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> \   </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> \</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">        z</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">   T3</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                       T1</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  T2</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> T3</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> T4</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">       /</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> \</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">     T1</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">   T2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>场景：插入的元素在不平衡元素的右侧的右侧</p><p>// 向左旋转过程</p><p>x.left = y;</p><p>y.right =(原x.left )</p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">对节点y进行向左旋转操作</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">，</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">返回旋转后新的根节点x</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">        y</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                             x</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">      /</span><span style="--shiki-light:#BDA437;--shiki-dark:#E6CC77;">  \ </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">                         /</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">   \</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">     T1</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">   x</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      向左旋转</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">y</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">       y</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">     z</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">         /</span><span style="--shiki-light:#BDA437;--shiki-dark:#E6CC77;"> \ </span><span style="--shiki-light:#AB5E3F;--shiki-dark:#C4704F;">  - - - - - - - -&gt;   </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> \   </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> \</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">       T2</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  z</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                     T1</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> T2</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> T3</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> T4</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">          /</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> \</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">         T3</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> T4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="avl树的问题" tabindex="-1"><a class="header-anchor" href="#avl树的问题"><span>AVL树的问题</span></a></h3><p>既然AVL树可以保证二叉树的平衡，这就意味着AVL搜索的时候，它最坏情况的时间复杂度O(logn) ，要低于普通二叉树BST和链表的最坏情况O(n)。</p><p>那么HashMap直接使用AVL树来替换链表就好了，为什么选择用红黑树呢？</p><p>原因是：</p><p>由于AVL树必须保证左右子树平衡，Max(最大树高-最小树高) &lt;= 1，</p><p>所以在插入的时候很容易出现不平衡的情况，一旦这样，就需要进行旋转以求达到平衡。</p><p>正是由于这种严格的平衡条件，导致AVL需要花大量时间在调整上，故AVL树一般使用场景在于<strong>查询场景</strong>， 而不是 <strong>增加删除 频繁</strong>的场景。</p><p><strong>红黑树(rbt)做了什么优化呢？</strong></p><p>红黑树(rbt)继承了AVL可自平衡的优点，</p><p>同时, 红黑树(rbt)在<strong>查询速率和平衡调整</strong>中寻找平衡，放宽了<strong>树的平衡条件</strong>，从而可以用于 <strong>增加删除 频繁</strong>的场景。</p><p>在实际应用中，红黑树的使用要多得多。</p><h2 id="红黑树-rbtree" tabindex="-1"><a class="header-anchor" href="#红黑树-rbtree"><span>红黑树（RBTree）</span></a></h2><p>红黑树是一种特化的 AVL 树，它是在1972年由 Rudolf Bayer 发明的，当时被称为平衡二叉B树（symmetric binary B-tree）。在 1978 年被 Leo J.Guibas 和 Robert Sedgewick 修改为如今的“红黑树”。</p><h3 id="什么是红黑树" tabindex="-1"><a class="header-anchor" href="#什么是红黑树"><span>什么是红黑树？</span></a></h3><p>红黑树也是一种自平衡二叉查找树，它与 AVL 树类似，都在添加和删除的时候通过旋转操作保持二叉树的平衡，已求更高效的查询性能。</p><p>与 AVL 树相比，红黑树牺牲了部分平衡性，以换取插入/删除操作时较少的旋转操作，整体来说性能要优于 AVL 树。</p><p>虽然红黑树是复杂的，但它的最坏情况运行时间也是非常良好的，并且在实践中是高效的：</p><blockquote><p>它可以在 O(log n) 时间内做查找，插入和删除，这里的 n 是树中元素的数目。</p></blockquote><h3 id="红黑树的特性" tabindex="-1"><a class="header-anchor" href="#红黑树的特性"><span>红黑树的特性</span></a></h3><p>红黑树是实际应用中最常用的平衡二叉查找树，它不严格的具有平衡属性，但平均的使用性能非常良好。</p><p>在红黑树中，节点被标记为红色和黑色两种颜色。</p><p>红黑树的原则有以下几点：</p><ul><li>节点非黑即红；</li><li>根节点一定是黑色；</li><li>叶子结点一定是黑色（且都为NIL）；</li><li>每个红色节点的两个子节点都是黑色（从每个叶子结点到根结点的所有路径上不能有两个连续的红色节点）；</li><li>从任一节点到其每个叶子结点的所有路径，都包含相同数目的黑色节点。</li></ul><p>红色属性说明，红色节点的子节点，一定是黑色。但是，黑色节点的子节点，可以是红色，也可以是黑色；</p><p>叶子属性说明，叶子结点是空的NIL，AVL 的叶子结点不是空的，具体见下图。</p><p><img src="/assets/20200901114718174-Ddf4Ly7R.png" alt="红黑树"></p><p>基于上面的原则，我们一般在插入红黑树节点的时候，会将这个结点设置为红色。参照最后一个原则：<strong>红色破坏原则的可能性最小</strong>，如果是黑色，很可能导致这条支路的黑色节点比其他支路的要多1个，破坏了平衡。</p><p>记忆要点：</p><p>可以按照括号里边的分类，记住红黑树的几个原则：</p><ul><li>（<strong>颜色属性</strong>）特性1：节点非黑即红；</li><li>（<strong>根属性</strong>）特性2：根节点一定是黑色；</li><li>（<strong>叶子属性</strong>）特性3：叶子节点（NIL）一定是黑色；</li><li>（<strong>红色属性</strong>）特性4：每个红色节点的两个子节点，都是黑色。（从每个叶子结点到根节点的所有路径上不能有两个连续的红色节点）</li><li>（<strong>黑色属性</strong>）特性5：从任一节点到其每个叶子的所有路径，都包含相同数目的黑色节点。</li></ul><p>黑色属性，可以理解为<strong>平衡特性</strong>，如果满足不了平衡特征，就要进行平衡操作。</p><p><strong>空间换时间</strong></p><p>红黑树有点属于一种空间换时间类型的优化，在 AVL 的节点上，增加了<strong>颜色属性</strong>的数据，相当于增加了空间的消耗。通过颜色属性的增加，换取后面平衡操作的次数减少。</p><h3 id="黑色完美平衡" tabindex="-1"><a class="header-anchor" href="#黑色完美平衡"><span>黑色完美平衡</span></a></h3><p>红黑树并不是一棵 AVL 平衡二叉搜索树，从图上可以看到，根结点 P 的左子树显然比右子树高。根据红黑树的特性5，从任一节点到其每个叶子结点的所有路径，都包含相同数目的黑色节点，说明：</p><blockquote><p>红黑树的左子树和右子树的黑色节点的层数是相等的。</p><p>红黑树的平衡条件，不是以整体的高度来约束的，而是以黑色节点的高度来约束的。</p></blockquote><p><img src="/assets/20210410220909965-QGF8NFvR.png" alt="黑色完美平衡树"></p><p>所以称红黑树的这种平衡为<strong>黑色完美平衡</strong>。</p><p>看看黑色完美平衡的效果，去掉红黑树中的红色节点，会得到一个四叉树，从根节点到每一个叶子结点，高度相同，就是红黑树的 Root 到叶子结点的黑色路径长度。</p><p><img src="/assets/41804394324546bebdfe22cd1c7a5bcc-DkWnF5ib.png" alt="红黑树演变"></p><h2 id="红黑树恢复平衡过程的三个操作" tabindex="-1"><a class="header-anchor" href="#红黑树恢复平衡过程的三个操作"><span>红黑树恢复平衡过程的三个操作</span></a></h2><p>一旦红黑树 5 个原则有不满足的情况，我们视为平衡被大屏，如何恢复平衡呢？</p><p>靠它的三种操作：<strong>变色、左旋、右旋</strong>。</p><h3 id="_1-变色" tabindex="-1"><a class="header-anchor" href="#_1-变色"><span>1. 变色</span></a></h3><p>节点的颜色由红变黑或由黑变红。</p><h3 id="_2-左旋" tabindex="-1"><a class="header-anchor" href="#_2-左旋"><span>2. 左旋</span></a></h3><p>以某个节点作为支点（pivot），其父节点（子树的 Root）旋转作为自己的左子树（左旋），pivot 的原左子树变成原 Root 节点的右子树，pivot 的原右子树保持不变。</p><p><img src="/assets/ba1adc2895cf4b1aaef2e7088d9f6a69-BU-Zmjk2.webp" alt="左旋动图"></p><p><img src="/assets/dea622e0576539552458e3afcffb1f59-4f_PHT1E.png" alt="左旋"></p><h3 id="_3-右旋" tabindex="-1"><a class="header-anchor" href="#_3-右旋"><span>3. 右旋</span></a></h3><p>以某个结点作为支点（pivot），其父节点（子树的 Root）旋转为自己的右子树（右旋），pivot 的原右子树变成原 Root 节点的左子树，pivot 的原左子树保持不变。</p><p><img src="/assets/96a7aa160f13424abb4acd1ada47edbf-BOoVLUQ9.webp" alt="右旋动图"></p><p><img src="/assets/82f3502b5be24051bd7688b1e0f36135-Ba0DhpY_.png" alt="右旋"></p><p>红黑树的左旋，右旋操作，和 AVL 树的左旋、右旋差不多。</p><h2 id="红黑树插入节点情景分析" tabindex="-1"><a class="header-anchor" href="#红黑树插入节点情景分析"><span>红黑树插入节点情景分析</span></a></h2><h3 id="红黑树的节点结构" tabindex="-1"><a class="header-anchor" href="#红黑树的节点结构"><span>红黑树的节点结构</span></a></h3><p>先看红黑树的节点结构，以 HashMap 中的红黑树的结构定义为例子：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">  static</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> Node</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> implements</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> Map</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Entry</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">        final</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> int</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> hash</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">        final</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> K</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">        volatile</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> V</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> val</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">        volatile</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Node</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> next</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">/**</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> * Nodes for use in TreeBins</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> */</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">static</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> final</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> TreeNode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> extends</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> Node</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    TreeNode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> parent</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // red-black tree links</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    TreeNode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> left</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    TreeNode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> right</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    TreeNode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> prev</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    // needed to unlink next upon deletion</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    boolean</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> red</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    TreeNode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">int</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> hash</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> K </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> V </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">val</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Node</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> next</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             TreeNode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> parent</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">        super</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">hash</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> val</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> next</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">        this</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">parent</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> parent</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>默认新插入的节点为红色：</p><p>因为父节点为黑色的概率较大，插入新节点为红色，可以避免颜色冲突。</p><h3 id="场景1-红黑树为空树" tabindex="-1"><a class="header-anchor" href="#场景1-红黑树为空树"><span>场景1：红黑树为空树</span></a></h3><p>直接把插入节点作为根节点就可以了。</p><p>另外：根据红黑树性质2：根节点是黑色的，还需要把插入节点设置为黑色。</p><h3 id="场景2-插入节点的-key-已经存在" tabindex="-1"><a class="header-anchor" href="#场景2-插入节点的-key-已经存在"><span>场景2： 插入节点的 Key 已经存在</span></a></h3><p>更新当且节点的值为插入节点的值。</p><p><img src="/assets/20210412094118977-D5vCJvOd.png" alt="插入节点的Key已经存在"></p><h3 id="场景3-插入节点的父节点为黑色" tabindex="-1"><a class="header-anchor" href="#场景3-插入节点的父节点为黑色"><span>场景3：插入节点的父节点为黑色</span></a></h3><p>由于插入的节点是红色的，当插入节点的父节点是黑色时，不会影响红黑树的平衡，所以：<strong>直接插入无需做自平衡</strong>。</p><p><img src="/assets/20210412094724987-DdkHcHCJ.png" alt="插入节点的父节点为黑色"></p><h3 id="场景4-插入节点的父节点为红色" tabindex="-1"><a class="header-anchor" href="#场景4-插入节点的父节点为红色"><span>场景4：插入节点的父节点为红色</span></a></h3><p>根据性质2：根节点是黑色。如果插入节点的父节点为红色节点，那么该父节点不可能为根节点，所以插入节点总是存在祖父节点（三代关系）。</p><p>根据性质4：每个红色节点的两个子节点一定是黑色的，不能有两个红色节点相连。</p><p>此时会出现两种情况：</p><ul><li>父节点和叔叔节点为红色；</li><li>父节点为红色，叔叔节点为黑色；</li></ul><p>如下图所示：</p><p><img src="/assets/20210412100154174-D3noDLRc.png" alt="父节点为红色的两种情况"></p><h4 id="场景4-1-父节点和叔叔节点都为红色" tabindex="-1"><a class="header-anchor" href="#场景4-1-父节点和叔叔节点都为红色"><span>场景4.1：父节点和叔叔节点都为红色</span></a></h4><p>根据性质4：红色节点不能相连，祖父节点肯定为黑色节点；父节点为红色，那么此时插入子树的红黑层数的情况是：黑红红。</p><p>因为不可能同时存在两个相连的红色节点，需要进行变色，显然处理方式是把其改为：红黑红。</p><p><strong>变色处理</strong>：黑红红 --&gt; 红黑红</p><ol><li>将 F 和 V 节点改为黑色；</li><li>将 P 改为红色；</li><li>将 P 设置为当前节点，进行后续处理。</li></ol><p><img src="/assets/2021041210371914-28SUJlNB.png" alt="红黑树插入节点变色"></p><p>可以看到，将 P 设置为红色了，如果 P 的父节点是黑色，那么无需做处理；但如果 P 的父节点是红色，则违反了红黑树性质了，所以需要将 P 设置为当且节点，继续插入操作，作自平衡处理，直到整体平衡为止。</p><h4 id="场景4-2-叔叔节点为黑色-父节点为红色-并且插在父节点的左子节点" tabindex="-1"><a class="header-anchor" href="#场景4-2-叔叔节点为黑色-父节点为红色-并且插在父节点的左子节点"><span>场景4.2：叔叔节点为黑色，父节点为红色，并且插在父节点的左子节点</span></a></h4><p>分两种情况：</p><ul><li>LL 红色插入</li></ul><p>叔叔为黑色，或者不存在（NIL）也是黑色节点，并且节点的父节点是祖父节点的左子节点。</p><p>注意：单纯从插入来看，叔叔节点非红即黑（NIL），否则破坏了红黑树性质5，此时路径会比其他路径多一个黑色节点。</p><p><img src="/assets/20210412104637494-Dy7lidNp.png" alt="img"></p><h5 id="场景4-2-1-ll-型失衡" tabindex="-1"><a class="header-anchor" href="#场景4-2-1-ll-型失衡"><span>场景4.2.1 LL 型失衡</span></a></h5><p>细分场景1：新插入节点，为其父节点的左子节点（LL 红色情况），插入后就是 LL型失衡。</p><p><img src="/assets/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZhbGxpbmdfc3RhcnNf-CevqPiQp.png" alt="LL型失衡"></p><p>自平衡处理：</p><ol><li>变色：将 F 设置为黑色，将 P 设置为红色。</li><li>对 F 节点进行右旋。</li></ol><p><img src="/assets/aHR0cHM6Ly9ib21312qwnlkasd23a23fasnNf-RyPofPFj.png" alt="LL型失衡自平衡"></p><h5 id="场景4-2-2-lr-型失衡" tabindex="-1"><a class="header-anchor" href="#场景4-2-2-lr-型失衡"><span>场景4.2.2 LR 型失衡</span></a></h5><p>细分场景2：新插入节点，为其父节点的右子节点（LR红色情况），插入后就是 LR 型失衡。</p><p><img src="/assets/20210412153113242-DluzvEby.png" alt="LR型失衡"></p><p>自平衡处理：</p><ol><li>对 F 进行左旋；</li><li>将 F 设置为当且节点，得到 LL 红色情况；</li><li>按照 LL 红色情况处理。</li></ol><p><img src="/assets/20210412153954767-DfyBL6ly.png" alt="LR失衡自平衡"></p><h4 id="场景4-3-叔叔为黑色-父节点为红色-并且父节点是祖父节点的右子节点" tabindex="-1"><a class="header-anchor" href="#场景4-3-叔叔为黑色-父节点为红色-并且父节点是祖父节点的右子节点"><span>场景4.3 叔叔为黑色，父节点为红色，并且父节点是祖父节点的右子节点</span></a></h4><p><img src="/assets/20221231231749030558826-72-DLiTOa_C.png" alt="img"></p><h5 id="场景4-3-1-rr-型失衡" tabindex="-1"><a class="header-anchor" href="#场景4-3-1-rr-型失衡"><span>场景4.3.1：RR 型失衡</span></a></h5><p>新插入节点，为其父节点的右子节点（RR 红色情况）</p><p><img src="/assets/20210412155529702-BQd041xg.png" alt="RR型失衡"></p><p>自平衡处理：</p><ol><li>变色：将 F 设置为黑色，将 P 设置为红色；</li><li>对 P 节点进行左旋。</li></ol><p><img src="/assets/20210412160829355-BVY5VQLS.png" alt="RR型自平衡"></p><h5 id="场景4-3-2-rl-型失衡" tabindex="-1"><a class="header-anchor" href="#场景4-3-2-rl-型失衡"><span>场景4.3.2：RL 型失衡</span></a></h5><p>新插入节点，为其父节点的左子节点（RL 红色情况）</p><p><img src="/assets/20210412161045393-jc9EVzeo.png" alt="RL型失衡"></p><p>自平衡处理：</p><ol><li>对 F 进行右旋；</li><li>将 F 设置为当前节点，得到 RR 红色情况；</li><li>按照 RR 红色情况处理。</li></ol><p><img src="/assets/20210412161924591-kdz-mUif.png" alt="RL型失衡自平衡"></p><h2 id="红黑树面试题" tabindex="-1"><a class="header-anchor" href="#红黑树面试题"><span>红黑树面试题：</span></a></h2><h3 id="有了二叉搜索树-为什么还需要平衡二叉树" tabindex="-1"><a class="header-anchor" href="#有了二叉搜索树-为什么还需要平衡二叉树"><span>有了二叉搜索树，为什么还需要平衡二叉树？</span></a></h3><p>二叉搜索树容易退化成一条链，这时，查找的时间复杂度从 O(log n) 也将退化成 O(N)。</p><p>引入对左右子树高度有限制的平衡二叉树 AVL，保证查找操作的最坏时间复杂度也为 O(log n)。</p><h3 id="有了平衡二叉树-为什么还需要红黑树" tabindex="-1"><a class="header-anchor" href="#有了平衡二叉树-为什么还需要红黑树"><span>有了平衡二叉树，为什么还需要红黑树？</span></a></h3><p>AVL 的左右子树高度差不能超过 1，每次进行插入/删除操作时，几乎都需要通过旋转操作保持平衡。在频繁进行插入/删除的场景中，频繁的旋转操作使得 AVL 的性能大打折扣。</p><p>红黑树通过牺牲严格的平衡，换取插入/删除时少量的旋转操作，整体性能优于 AVL：</p><ul><li>红黑树插入时的不平衡，不超过两次选择就可以解决；删除时的不平衡，不超过三次选择就能解决。</li><li>红黑树的红黑规则，保证最坏的情况下，也能在 O(log n)时间内完成查找操作。</li></ul><h3 id="红黑树那几个原则-你还记得吗" tabindex="-1"><a class="header-anchor" href="#红黑树那几个原则-你还记得吗"><span>红黑树那几个原则，你还记得吗？</span></a></h3><ul><li>（颜色属性）节点非黑即红；</li><li>（根属性）根节点一定是黑色；</li><li>（叶子属性）叶子节点（NIL）一定是黑色；</li><li>（红色属性）每个红色节点的两个子节点都是黑色。（从每个叶子节点到根节点的路径上不能有两个连续的红色节点）；</li><li>（黑色属性）从任一节点到其每个叶子结点的路径，都包含相同数目的黑色节点。</li></ul><h3 id="红黑树写入操作-是如何找到他的父节点的" tabindex="-1"><a class="header-anchor" href="#红黑树写入操作-是如何找到他的父节点的"><span>红黑树写入操作，是如何找到他的父节点的？</span></a></h3><p>红黑树的节点 TreeNode 他就是继承 Node 结构的。</p><p>先看看红黑树的节点结构，以 HashMap 中的红黑树的结构定义为例子：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">  static</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> Node</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> implements</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> Map</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Entry</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">        final</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> int</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> hash</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">        final</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> K</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">        volatile</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> V</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> val</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">        volatile</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Node</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> next</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">/**</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> * Nodes for use in TreeBins</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> */</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">static</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> final</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> TreeNode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> extends</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> Node</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    TreeNode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> parent</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // red-black tree links</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    TreeNode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> left</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    TreeNode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> right</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    TreeNode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> prev</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    // needed to unlink next upon deletion</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    boolean</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> red</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    TreeNode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">int</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> hash</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> K </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> V </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">val</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Node</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> next</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             TreeNode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">V</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> parent</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">        super</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">hash</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> val</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> next</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">        this</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">parent</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> parent</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TreeNode 在 Node 基础上加了几个字段，分别指向父节点 parent，然后指向左子节点 left，右子节点 right，还有表示颜色的 red 属性。</p><p><strong>红黑树插入操作：</strong></p><p>首先是找到一个合适的插入点，即找到插入节点的父节点，由于红黑树满足 BST 二叉查找树的有序特性，这个找父节点的操作和二叉查找树是完全一致的。</p><p>二叉查找树，左子节点小于当前节点，右子节点大于当前节点，每一次向下查找一层就可以排除掉一半的数据，查找的效率在 O(log n)，最终查找到 NIL 节点或者 key 一样的节点。</p><p>如果最终查找到 key 一样的节点，进行更新操作。这个 TreeNode.key 与当前 put.key 完全一致。这就不需要插入，替换 value 就可以了，父节点就是当前节点的父节点。</p><p>如果最终查找到 NIL 节点，进行插入操作。NIL 节点的父节点，就是当前节点的父节点，把插入的节点替换 NIL 节点，然后进行红黑树的平衡处理。</p><h3 id="红黑树有哪些内部操作" tabindex="-1"><a class="header-anchor" href="#红黑树有哪些内部操作"><span>红黑树有哪些内部操作</span></a></h3><p>变色：把一个红色节点变成黑色，或者把一个黑色的节点变成红色，就是对这个节点的变色。</p><p>旋转：与平衡二叉树的选择操作类似。</p><h3 id="红黑树与-avl-树的区别" tabindex="-1"><a class="header-anchor" href="#红黑树与-avl-树的区别"><span>红黑树与 AVL 树的区别</span></a></h3><p><strong>1、调整平衡的实现机制不同</strong></p><p>红黑树根据路径上黑色节点数目一致，来确定是否失衡，如果失衡，就通过变色和旋转来恢复；</p><p>AVL 根据树的平衡因子(<strong>所有节点的左右子树高度差的绝对值不超过1</strong>)，来确定是否失衡，如果失衡，就通过旋转来恢复。</p><p><strong>2、红黑树的插入效率更高</strong></p><p>红黑树是用<strong>非严格的平衡</strong>来换取增删节点时候旋转次数的降低，<strong>任何不平衡都会在三次旋转之内解决</strong>，红黑树并不追求“完全平衡”，它只要求部分地达到平衡要求，降低了对旋转的要求，从而提高了性能</p><p>而 AVL 是<strong>严格平衡树</strong>(高度平衡的二叉搜索树)，因此在增加或者删除节点的时候，根据不同情况，旋转的次数比红黑树要多。</p><p>所以红黑树的插入效率更高。</p><p><strong>3、红黑树统计性能比 AVL 树更高</strong></p><p>红黑树能够以<strong>O(log n)</strong> 的时间复杂度进行查询、插入、删除操作。</p><p>AVL 树查找、插入和删除在平均和最坏情况下都是<strong>O(log n)</strong>。</p><p>红黑树的算法时间复杂度和 AVL 相同，<strong>但统计性能比 AVL 树更高</strong>，</p><p><strong>4、适用性：AVL 查找效率高</strong></p><p><strong>如果你的应用中，查询的次数远远大于插入和删除，那么选择 AVL 树，如果查询和插入删除次数几乎差不多，应选择红黑树</strong>。</p><p>即，有时仅为了排序（建立-遍历-删除），不查找或查找次数很少，红黑树更合算一些。</p></div><!----><!----><!----></div></main><footer class="vp-doc-footer" data-v-560bc32b data-v-c857328b><!--[--><!--]--><div class="edit-info" data-v-c857328b><div class="edit-link" data-v-c857328b><a class="vp-link no-icon link edit-link-button" href="https://github.com/ShaddockWong/edit/main/docs/4.数据结构与算法/2.红黑树.md" target="_blank" rel="noreferrer" data-v-c857328b data-v-4f934dc8><!--[--><span class="vpi-square-pen edit-link-icon" aria-label="edit icon" data-v-c857328b></span> 编辑此页<!--]--><!----></a></div><!----></div><div class="contributors" aria-label="Contributors" data-v-c857328b><span class="contributors-label" data-v-c857328b>贡献者: </span><span class="contributors-info" data-v-c857328b><!--[--><!--[--><span class="contributor" data-v-c857328b>ShaddockWong</span><!----><!--]--><!--]--></span></div><nav class="prev-next" data-v-c857328b><div class="pager" data-v-c857328b><!----></div><div class="pager" data-v-c857328b><a class="vp-link no-icon link pager-link next" href="/article/lt193jaj/" data-v-c857328b data-v-4f934dc8><!--[--><span class="desc" data-v-c857328b>下一页</span><span class="title" data-v-c857328b>1.图解数据结构</span><!--]--><!----></a></div></nav></footer><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button style="display:none;" type="button" class="vp-back-to-top" aria-label="back to top" data-v-1fc9cae9 data-v-dec48c97><span class="percent" data-allow-mismatch data-v-dec48c97>0%</span><span class="show icon vpi-back-to-top" data-v-dec48c97></span><svg aria-hidden="true" data-v-dec48c97><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-dec48c97></circle></svg></button><footer class="vp-footer" vp-footer data-v-1fc9cae9 data-v-55c60c4a><!--[--><div class="container" data-v-55c60c4a><p class="message" data-v-55c60c4a>Powered by <a target="_blank" href="https://v2.vuepress.vuejs.org/">VuePress</a> & <a target="_blank" href="https://theme-plume.vuejs.press">vuepress-theme-plume</a></p><!----></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-k3221GFj.js" defer></script></body></html>